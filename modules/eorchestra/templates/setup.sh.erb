#!/bin/bash

EORCHESTRA_DIR=/home/eorchestra
VENV_DIR=$EORCHESTRA_DIR/venv

cd $EORCHESTRA_DIR 
git clone https://github.com/agoraciudadana/frestq
git clone https://github.com/agoraciudadana/election-orchestra
source $VENV_DIR/bin/activate
cd $EORCHESTRA_DIR/frestq
python setup.py install
cd $EORCHESTRA_DIR/election-orchestra
export FRESTQ_SETTINGS=base_settings.py 
python app.py --createdb

C=ES
ST=Madrid
L=Madrid
O=Agoravoting
OU=CongresoTransparente
HOST=${1:-`hostname`}
CN=${1:-`hostname`}
EMAIL=info@congresotransparente.com

rm $EORCHESTRA_DIR/election-orchestra/certs/selfsigned/*
cd $EORCHESTRA_DIR/election-orchestra/certs/selfsigned/
openssl req -nodes -x509 -newkey rsa:4096 -keyout key-nopass.pem -out cert.pem -days 365 <<EOF
${C}
${ST}
${L}
${O}
${OU}
${CN}
${EMAIL}
EOF

cp cert.pem calist
